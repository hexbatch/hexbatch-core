openapi: 3.1.0
info:
  title: 'Hexbatch Core'
  version: '0.1'
paths:
  /api/v1/users/me:
    get:
      summary: 'This will show the user and default namespace details'
      description: 'Shows the logged in user'
      operationId: core.users.me
      responses:
        '200':
          description: 'This is you'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Me'
  /api/v1/users/login:
    post:
      operationId: core.users.login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginParams'
      responses:
        '200':
          description: 'Login returns a token'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  /api/v1/users/register:
    post:
      operationId: core.users.register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistrationParams'
      responses:
        '201':
          description: 'Register with just a username and a password'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Me'
  /api/v1/users/logout:
    delete:
      summary: 'Logs the user out of all tokens (destroys all tokens)'
      operationId: core.users.logout
      responses:
        '200':
          description: 'All the tokens owned by the user were destroyed'
  /api/v1/users/auth/create:
    post:
      summary: 'Create a new token with optional lifetime set in seconds'
      description: 'Any json set in the body is converted to passthrough data, which is data associated with the logged in token'
      operationId: core.users.auth.create
      parameters:
        -
          name: seconds
          in: path
          description: 'determines seconds to live, optional'
          required: false
          schema:
            $ref: '#/components/schemas/hexbatch_seconds_to_live'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              description: 'Anything passed to the body is considered passthrough data'
              type:
                - object
                - 'null'
      responses:
        '201':
          description: 'Returns a new token set to that lifetime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateTokenResponse'
  /api/v1/users/auth/passthrough:
    get:
      summary: 'Gets the passthrough data associated with this token used to authenticate this call'
      operationId: core.users.auth.passthrough
      responses:
        '200':
          description: 'Gets any immutable passthrough data stored when the token was created'
          content:
            application/json:
              schema:
                type:
                  - object
                  - 'null'
  /api/v1/users/auth/remove_current_token:
    delete:
      summary: 'Deletes the current token, other tokens not deleted'
      description: 'Allows for services to create extra tokens, use them, and then remove them'
      operationId: core.users.auth.remove_current_token
      responses:
        '204':
          description: 'Nothing returned'
  /api/v1/design/change_owner:
    post:
      summary: 'Changes the ownership of a type before its published.  '
      description: 'The owner ns can transfer this unpublished design to be owned by another namespace. Owners of subtypes can deny this change by listening to the type_owner_change event raised by this action'
      operationId: core.design.change_owner
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/promote_owner:
    post:
      summary: 'Changes the ownership of a type before its published. '
      description: 'The system can transfer this design to be managed by another namespace. No events are raised that can deny the change.'
      operationId: core.design.promote_owner
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/promote:
    post:
      summary: 'Makes a new design type with anyone as the owner '
      description: 'The system can make a new design and assign this to any owner. No events are raised'
      operationId: core.design.promote
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/purge:
    delete:
      summary: 'Deletes an unpublished type '
      description: 'The system can delete any design, owned by anyone, before publishing, without raising any events'
      operationId: core.design.purge
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/destroy:
    delete:
      summary: 'Deletes an unpublished type '
      description: 'A namespace can delete a new design, before publishing, without raising any events'
      operationId: core.design.destroy
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/create:
    post:
      summary: 'Makes a new design type '
      description: 'A namespace can make a new design, they are the owner. No events are raised'
      operationId: core.design.create
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/edit:
    patch:
      summary: 'Edits the name, final type, access '
      description: "The owner or their admin group can change, before publishing, the name of the type, final status and access level \nNo events are raised"
      operationId: core.design.edit
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/show:
    get:
      summary: 'Shows information about a type '
      description: "See details about a type in any state. Lists the attributes, event listeners, live requirements and live rules \nIf the design type is set to public access, then any namespace can use this to see the information. Otherwise only the members of the owner namepace can \nTo see more detail about any one of these, use the show api for that reference"
      operationId: core.design.show
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/list:
    get:
      summary: 'Lists all the designed owned or managed  '
      description: "See a list of all the designs this namespace either owns or has admin rights to. Once a type is published, it is not seen here\nCan see the name, uuid, the status and how many attributes, listeners, requirements and rules there are"
      operationId: core.design.list
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/show_attribute:
    get:
      summary: 'Information about a single attribute on a type  '
      description: "See information about an attribute. Will list the settings and bounds, will show parent, and status \nShows stats about its descendants\nif the type is marked as public, and the attribute is marked as public then any namespace can use this,  \notherwise the members of the owning namesapce can "
      operationId: core.design.show_attribute
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/destroy_attribute:
    delete:
      summary: 'Delete an attribute'
      description: "Destroys an attribute. Attributes cannot be deleted after a type is published \nRemoving design attributes does not generate any event"
      operationId: core.design.destroy_attribute
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/promote_attribute:
    post:
      summary: 'Creates a new attribute on a design for any design or namespace'
      description: "System can create a new attribute using any parent chain for any design owned by anyone \nThis does not generate any events"
      operationId: core.design.promote_attribute
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/create_attribute:
    post:
      summary: 'Creates a new attribute on a design'
      description: "Namespace admin group can create a new attribute using any parent chain for any design owned by anyone \nBut the design can only be published if the inheritance chain does not block this using the design_pending event"
      operationId: core.design.create_attribute
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/list_attributes:
    get:
      summary: 'Lists the attributes of a type  '
      description: "See a list of all the attributes the type uses\nShows information about its ancestors\nif the type is marked as private or the attribute is marked as private,\n then that attribute is not shown except to the members of the owning namesapce"
      operationId: core.design.list_attributes
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/set_attribute_location:
    patch:
      summary: 'Gives the attribute a shape or map  '
      description: "Each attribute can have one map or shape, or none at all\nCall this with no boundary to clear\nThe bounds of the type as a whole is a union of the attribute maps"
      operationId: core.design.set_attribute_location
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/test_attribute_location:
    get:
      summary: 'Allows testing and debugging of an attribute bounds  '
      description: "Tests the attribute bounds with geojson points and shapes, or other types and attributes\nif the type is marked as private or the attribute is marked as private,\n then that attribute is not testable except to the members of the owning namesapce. \n If using other attributes to test with, must be able to see that attribute. "
      operationId: core.design.test_attribute_location
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/edit_attribute:
    patch:
      summary: 'Edits the properites of an unpublished attribute  '
      description: "Owner admin group can set the following properties to an attribute: \nparent, boolean properties, merge methods, access, value policy, value rules, initial value"
      operationId: core.design.edit_attribute
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/create_listener:
    post:
      summary: 'Makes a new event listener for an attribute on the design '
      description: "Each attribute can have zero or one listeners. If replacing, then earlier must be destroyed. \nOwner admin group can create a listener on each attribute, as long as the type is not published \nIf inheriting from a parent, and that has a listener, then the listener must be for the same event type "
      operationId: core.design.create_listener
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/destroy_listener:
    delete:
      summary: 'Makes a new event listener for an attribute on the design '
      description: 'Owner admin group can can remove the event listener from the attribute, before publishing '
      operationId: core.design.destroy_listener
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/list_listeners:
    get:
      summary: 'Allows testing and debugging of an attribute bounds  '
      description: "Lists all the listeners, and the attributes that hold them, and the events listened \n To see the rules then use the show listener\n if the type is marked as private or the attribute is marked as private,\n then the listener is not shown except to the members of the owning namesapce"
      operationId: core.design.list_listeners
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/show_listener:
    get:
      summary: 'Shows information about a specific listener'
      description: "Shows the information about the listener, including the rules it uses \n This is only shown to the owning namespace members"
      operationId: core.design.show_listener
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/create_rule:
    post:
      summary: 'Creates a rule or rule tree attached to the root or existing rule '
      description: "Each listener can have a tree of rules with a single top root, but can have any number of branches or leaves \nOwner admin group can add a single rule, or a tree of rules, and that can be attached to the unoccupied root, or to a leaf "
      operationId: core.design.create_rule
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/destroy_rule:
    delete:
      summary: 'Removes a single rule and all its children '
      description: "The listener tree can be edited by deleting parts of it. \nOwner admin group can prune the tree by branches or leaves "
      operationId: core.design.destroy_rule
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/edit_rule:
    post:
      summary: 'Edits a single rule and all its children '
      description: "The listener tree can be edited by changing one rule and its children \n For existing rules can change the phase,path,rank,logic, merge method and filter \n Owner admin group edit each leaf or branches or the entire tree "
      operationId: core.design.edit_rule
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/test_listener:
    get:
      summary: 'Test a rule tree against  '
      description: "A listener can be tested against a simulated event \n The tester provides the set, element, event, as long as the namespace using this can see the set and/or element, can test "
      operationId: core.design.test_listener
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/remove_parent:
    delete:
      summary: 'Removes a parent'
      description: "The owner or admin group can remove one or more parents from a design using a path. \nThis can be removed regardless of the approval status \nParents need approval to use, but do not notify the inheritance chain of design changes when dropping that parent"
      operationId: core.design.remove_parent
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/add_parent:
    post:
      summary: 'Adds a parent'
      description: "The owner or admin group can add one or more published parents using a path.\n Regardless who owns it, the event of design_pending can block it from the inheritance chaing\n If a parent is declared retired or suspended before publishing, then this type cannot be published until that is changed\nParents need approval to use in the design, and later to publish, to look over any conflicts after the design allowed"
      operationId: core.design.add_parent
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/list_parents:
    get:
      summary: 'Lists the parents of a type  '
      description: "Lists the parents the type (published or any other state) uses. \nLists the status of each parent, both their own lifecycle and the approval status being used here\n If the type has public access, then any namespace can see this. Otherwise its members of the owning namespace "
      operationId: core.design.list_parents
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/list_live_rules:
    get:
      summary: 'Lists live rules for the type  '
      description: "Lists the live rules defined for this type. \n If the type has public access, then any namespace can see this. Otherwise its members of the owning namespace "
      operationId: core.design.list_live_rules
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/add_live_rule:
    post:
      summary: 'Adds a new live rule to the type before its published '
      description: 'Owner admin group can add live rules to be applied after the publishing and making sets out of this '
      operationId: core.design.add_live_rule
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/remove_live_rule:
    delete:
      summary: 'Removes a live rule '
      description: 'Owner admin group can remove a live rule before its published '
      operationId: core.design.remove_live_rule
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/test_location:
    get:
      summary: 'Tests the type schedule  '
      description: "Tests the bounds of the type with geo-json or given another type, element or set. \n If the type is marked as private,\n then only testable to the members of the owning namesapce. "
      operationId: core.design.test_location
      responses:
        '501':
          description: 'Not yet implemented'
  /api/v1/design/test_time:
    get:
      summary: 'Tests the type schedule  '
      description: "Tests schedule of the type with any generated time string \n If the type is marked as private,\n then only testable to the members of the owning namesapce. "
      operationId: core.design.test_time
      responses:
        '501':
          description: 'Not yet implemented'
components:
  schemas:
    hexbatch_uuid:
      title: 'Unique reference'
      description: 'Defines a regular uuid'
      type: string
      maxLength: 36
      minLength: 36
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      example:
        -
          summary: 'Should be unique across the world'
          value: 59714b32-a017-4300-afbc-f910886a2589
    CreateTokenResponse:
      description: 'Returns the token that is required other api calls'
      properties:
        auth_token:
          $ref: '#/components/schemas/hexbatch_token'
      type: object
    hexbatch_seconds_to_live:
      title: 'Seconds to live'
      description: 'When needing to give a length in seconds up to a year'
      type: integer
      format: int32
      maxLength: 31536000
      minLength: 1
      example:
        -
          summary: 'A lifetime of 6 months'
          value: '15768000'
    hexbatch_token:
      title: 'A token used to authenticate'
      description: 'Defines a regular uuid'
      type: string
      maxLength: 60
      minLength: 40
      example:
        -
          summary: 'Tokens look like this, but not always'
          value: 2|jY8m3acW2GdDZlgJOxX2hWCjlRJ6lcu4OA3q3XWcc4cbc545
    hexbatch_username:
      title: 'User Name'
      description: 'Defines a user name'
      type: string
      maxLength: 30
      minLength: 3
      pattern: '^\p{L}[\p{L}0-9_]{2,}$'
      example:
        -
          summary: 'No capital letters, no punctuation, underscores allowed, numbers allowed after first letter'
          value: my_first_user221
    LoginParams:
      description: 'Login requires a username and password'
      properties:
        username:
          $ref: '#/components/schemas/hexbatch_username'
        password:
          title: Password
          type: password
          example:
            -
              summary: 'password set up in the registration'
              value: beans_r_88good
      type: object
      example:
        -
          summary: 'logging in example'
          value:
            username: will
            password: xamp
        -
          summary: 'logging 2 in example'
          value:
            username: will2
            password: xamp22
    LoginResponse:
      description: 'Returns the token that is required other api calls'
      properties:
        message:
          title: Message
          type: string
        auth_token:
          $ref: '#/components/schemas/hexbatch_token'
      type: object
    Me:
      description: 'Show details about the logged-in user'
      properties:
        uuid:
          $ref: '#/components/schemas/hexbatch_uuid'
        username:
          title: 'User name'
          type: string
        registered_at:
          title: 'When the user was registered'
          type: string
          format: date-time
      type: object
    RegistrationParams:
      description: 'Login requires a username and password'
      properties:
        username:
          $ref: '#/components/schemas/hexbatch_username'
        password:
          title: Password
          type: password
          example:
            -
              summary: 'password set up in the registration'
              value: beans_r_88good
      type: object
      example:
        -
          summary: 'Registration Example'
          value:
            username: will
            password: xamp
